#! /bin/sh
mkdir -p /var/log/sendmailwrapper || exit 1
chmod a+wx /var/log/sendmailwrapper || exit 2
chmod a+r /var/log || exit 3

if [ -f /etc/sendmailwrapper/pwdblacklisti ]; then
        if [ -f /etc/sendmailwrapper/directoryblacklist ]; then
                cat /etc/sendmailwrapper/pwdblacklist >> /etc/sendmailwrapper/directoryblacklist
                rm /etc/sendmailwrapper/pwdblacklist;
        else
                mv /etc/sendmailwrapper/pwdblacklist /etc/sendmailwrapper/directoryblacklist
        fi
fi

if [ -d /etc/munin/plugins ]; then
	if [ -f /etc/munin/plugins/sendmailwrapper ]; then
		echo "ERROR: Failed to create munin plugin; file /etc/munin/plugins/sendmailwrapper already exists";
	else
		sendmailwrapper-stats --munin-create-plugin > /etc/munin/plugins/sendmailwrapper
		/etc/init.d/munin-node restart
	fi
fi
